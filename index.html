<head>
	<script src="//cdn.rawgit.com/namuol/cheet.js/master/cheet.min.js" type="text/javascript"></script>
	<script src="https://cdn.jsdelivr.net/g/embed.js@4.1.3,sweetalert2@6.4.3"></script>
	<link href="https://fonts.googleapis.com/css?family=Walter+Turncoat" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/sweetalert2/6.4.3/sweetalert2.min.css">
	<title>Sumo.io</title>

	<style>
		body {
			background-color: #fff;
			background-image: linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px), linear-gradient(#eee .1em, transparent .1em);
			background-size: 100% 1.2em;
			font-family: Walter Turncoat;
		}
		
		.swal2-modal,
		.swal2-show,
		.swal2-input,
		.swal2-confirm,
		.swal2-styled {
			font-family: Walter Turncoat;
		}
		
		#pageTitle {
			color: black;
			font-size: 50px;
			margin-bottom: -5px;
		}
		
		.reset {
			text-decoration: none;
		}
		
		#ctx {}
	</style>

</head>

<body>
	<center>
		<a href="#" onclick="window.location.reload();" class="reset">
			<h1 id="pageTitle">Sumo.io</h1>
		</a>
		<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>
		<img id="player" width="50" height="50" src="./Player.png" hidden>
	</center>
	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
	<script type="text/javascript">
		cheet("t i t l e", function() {
			changeTitle();
		});

		cheet('↑ ↑ ↓ ↓ ← → ← → b a', function() {
			changeTitle();
		});

		cheet("d e v", function() {
			dev = !dev, !dev
		});

		Array.prototype.randomElement = function() {
			return this[Math.floor(Math.random() * this.length)]
		};
	</script>

	<script>
		var ctx = document.getElementById("ctx").getContext("2d");
		var gameData = {};
		var playerImage = document.getElementById("player");
		var packs = 0;
		var emoticons = ["d(^^)b", "┏(＾0＾)┛", "[^.^]", "[▪‿▪]", "<('o'<)", "(─‿─)", "(-_-)", "(^.^)", "(❁‿❁)", "(╯°□°）╯", "ʘ‿ʘ", "(∪ ◡ ∪)"];
		var names = ["ninja", "chair", "pancake", "statue", "unicorn", "rainbows", "laser", "senor", "bunny", "captain", "nibblets", "cupcake", "carrot", "gnomes", "glitter", "potato", "salad", "toejam", "curtains", "beets", "toilet", "exorcism", "stick figures", "mermaid eggs", "sea barnacles", "dragons", "jellybeans", "snakes", "dolls", "bushes", "cookies", "apples", "ice cream", "ukulele", "kazoo", "banjo", "opera singer", "circus", "trampoline", "carousel", "carnival", "locomotive", "hot air balloon", "praying mantis", "animator", "artisan", "artist", "colorist", "inker", "coppersmith", "director", "designer", "flatter", "stylist", "leadman", "limner", "make-up artist", "model", "musician", "penciller", "producer", "scenographer", "set decorator", "silversmith", "teacher", "auto mechanic", "beader", "bobbin boy", "clerk of the chapel", "foreman", "mechanic", "miller", "moldmaker", "panel beater", "patternmaker", "plant operator", "plumber", "sawfiler", "shop foreman", "soaper", "stationary engineer", "wheelwright", "woodworkers", "home owner", "hacker", "human"];
		var color = ["#ed8917", "#6a4fe2", "#03a592", "#f49ab5", "#d1102a", "#2fa2bc", "#f93490", "#890d02", "#f9a8a7", "#0be82c", "#a6e9ed", "#f9e9c2", "#b21851", "#ba55f4", "#00d161", "#c9f9a9", "#81f742", "#6866e2", "#e55820", "#d147ed", "#7faeff", "#c98244", "#03724d", "#dd6052", "#88bee2", "#e285d0", "#4be590", "#290ad6", "#a4bee8", "#ed449e", "#ef58b3", "#d112d1", "#99ef2f", "#b24b13", "#f9bbc8", "#42ed8f", "#829cdd", "#5460e5", "#feccff", "#7ff4f0", "#3944e5", "#f4d4a4", "#199e64", "#64e06b", "#d1661f", "#477caa", "#5ad829", "#c63c2f", "#706ccc", "#a153cc", "#258bea", "#a3ed78", "#77bbef", "#e29d68", "#eaba9a", "#e5203d", "#6bd849", "#3da9c6", "#c41993", "#413fbf", "#00005e", "#81add1", "#2c60f9", "#5534db", "#68bbc4", "#ef2de9", "#a66cf7", "#11c6dd", "#a3d35f", "#a53427", "#18af18", "#ff3f35", "#0b9e2a", "#5caef2", "#eaa4c5", "#5beac6", "#ff948e", "#1df47e", "#0d8413", "#11d7db", "#7ee5c3", "#320f84", "#48f248", "#d082dd", "#978bd6", "#07c644", "#db2b95", "#af5ff4", "#bc271a", "#7ce2b4", "#f9c2d7", "#24d5e5", "#7884e2", "#024ced", "#b3a8ff", "#e7ffaa", "#77b52b", "#44fca3", "#d85d0a", "#61a31f", "#d1a6ed", "#efeb7f", "#1c0a75", "#dd855d", "#f2a7cb", "#6e4ac9", "#b6d84e", "#3dc407", "#d03bf9", "#dd493b", "#1efc85", "#db1360", "#39e51b", "#c95548", "#0b3ca5", "#919e06", "#5313c1", "#ffc9ca", "#088593", "#8cf7f7", "#ce5331", "#40a5a5", "#8fbeea", "#a51554", "#72d2db", "#8631ed", "#f99da2", "#60ea77", "#5ff900", "#7da7db", "#72f9c8", "#c9e6ff", "#ff5462", "#37dce8", "#6b85ce", "#1a7fcc", "#bf6326", "#99ecf7", "#234899", "#0bbc64", "#92d9e5", "#e5c392", "#a3421b", "#30e5d0", "#cca404", "#f47f1f", "#43d88b", "#d3ef1c", "#aee9ef", "#ce45e0", "#50e5d4", "#bfdaff", "#503af4", "#2d20db", "#e88f92", "#e575a3", "#88e85f", "#a7f93b", "#04f7a6", "#2dfc72", "#ccdcff", "#59e0b1", "#8ee02a", "#94fcbe", "#2e81f4", "#37d6c8", "#5d89cc", "#aafff7", "#ff16f3", "#2d4ce5", "#fcf99f", "#8ffcc4", "#991e37", "#cd4efc", "#ea252f", "#dfed95", "#e5cf8e", "#f9b3c4", "#79a9ce", "#5a0b84", "#b1d668", "#94f79e", "#fffcb2", "#d6bdf9", "#91c938", "#d63346", "#4698db", "#a81039", "#30e8a7", "#abea5d", "#ebbaf4", "#eda674", "#b0fcae", "#723aaa", "#1e56bf", "#d8a720", "#c62ee8", "#1f3e91", "#63ff8a", "#f4a8de"]
		var servers = ["//0.sumo-io.tk", "//1.sumo-io.tk/", "//2.sumo-io.tk/"];
		var socket;
		var players = {};
		var socket_my;

		function changeTitle() {
			var tempMote = emoticons.randomElement();
			var pageTitle = tempMote + " SumoKick.io " + tempMote;
			document.getElementById("pageTitle").innerHTML = pageTitle;
			return pageTitle;
		}

		var dev = false;

		var fps = 0;

		var fpsTimer = setInterval(function() {
			fps = 0;
		}, 1000);

		function connect(data) {
			var hashData = data.split(",");
			var server = servers[getParameterByName("ip")] || servers.randomElement();
			socket = io(server, {
				query: `name=${hashData[0]}&color=${hashData[1]}`
			});

			if (getParameterByName("admin")) {
				socket.emit("-1", getParameterByName("admin"));
			}

			socket.on('connect_error', function() {
				swal(
					'Server issue... Please try again in 30s-60s',
					'error'
				)
			});

			const player = {
				width: 25,
				height: 25,
				directionW: 10,
				directioH: 5
			}

			function onPacket() {
				packs++;
				fps++;
				if (dev) {
					window.document.title = `FPS : ${fps} Packs : ${packs}`;
				}
			}

			socket.on('1', function(data) {
				onPacket();
				gameData = data;
				render();
			});

			socket.on("0", function(data) {
				socket_my = data;
			});

			socket.on("3", function(data) {
				socket.disconnect();
				switch (data) {
					case "redjive":
						alert("Your Welcome");
						break;
					case "redhawk654":
						alert("Go hawk yourself");
						break;
					case "herohamp":
						alert("I am your hero");
						break;
					case "game guy7":
						alert("I'll be your guy");
						break;
					case "shawnieplayz":
						alert("Get Played!");
						break;
					case "carolyn":
						alert("ICE CREAM!!!!");
						break;
				}
				window.location.reload();
			});

			function render() {
				ctx.clearRect(0, 0, 500, 500);

				for (i in gameData) {
					if (gameData[i] != null) {
						let sPlayer = gameData[i]
						ctx.fillStyle = sPlayer.color;
						ctx.strokeRect(sPlayer.x, sPlayer.y, player.width, player.height);
						ctx.fillRect(sPlayer.x, sPlayer.y, player.width, player.height);
						ctx.fillStyle = "black";
						ctx.font = "15px Walter Turncoat";
						//ctx.fillText(sPlayer.direction, sPlayer.x, sPlayer.y + player.height / 2);
						if (socket_my == i.toString()) {
							ctx.fillStyle = "red";
							ctx.fillText(`You (${sPlayer.points})`, sPlayer.x, sPlayer.y);
						}
						else {
							ctx.fillText(`${sPlayer.name} (${sPlayer.points})`, sPlayer.x, sPlayer.y);
						}
					}
				}

			}

			socket.on('2', function(data) {
				onPacket();
				for (i in data) {
					gameData[i] = data[i];
				}
				render();
			});

			document.onkeydown = function(event) {
				if (event.keyCode === 68 || event.keyCode === 39) { //d
					socket.emit('keyPress', {
						inputId: 'right',
						state: true
					});
				}
				else if (event.keyCode === 83 || event.keyCode === 40) { //s
					socket.emit('keyPress', {
						inputId: 'down',
						state: true
					});
				}
				else if (event.keyCode === 65 || event.keyCode === 37) { //a
					socket.emit('keyPress', {
						inputId: 'left',
						state: true
					});
				}
				else if (event.keyCode === 87 || event.keyCode === 38) { // w
					socket.emit('keyPress', {
						inputId: 'up',
						state: true
					});
				}

			}
			document.onkeyup = function(event) {
				if (event.keyCode === 68 || event.keyCode === 39) { //d
					socket.emit('keyPress', {
						inputId: 'right',
						state: false
					});
				}
				else if (event.keyCode === 83 || event.keyCode === 40) { //s
					socket.emit('keyPress', {
						inputId: 'down',
						state: false
					});
				}
				else if (event.keyCode === 65 || event.keyCode === 37) { //a
					socket.emit('keyPress', {
						inputId: 'left',
						state: false
					});
				}
				else if (event.keyCode === 87 || event.keyCode === 38) { // w
					socket.emit('keyPress', {
						inputId: 'up',
						state: false
					});
				}
			}

		}

		setInterval(function() {
			//changeTitle();
		}, 15000);

		function getParameterByName(name, url) {
			if (!url) {
				url = window.location.href;
			}
			name = name.replace(/[\[\]]/g, "\\$&");
			var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
				results = regex.exec(url);
			if (!results) return null;
			if (!results[2]) return '';
			return decodeURIComponent(results[2].replace(/\+/g, " "));
		}
	</script>
	<script>
		function pro() {
			swal(
				'Not Pronounced (Sumo-IO)',
				'Pronounced (Sumo-E-O)',
				'error'
			)
		}

		function start() {

			if (window.location.hash != "" && window.location.hash != "#") {
				connect(`${window.location.hash.substring(1)}`);
			}
			else {

				swal({
					title: 'What is should your name be?',
					input: 'text',
					showCancelButton: false,
					allowEscapeKey: false,
					inputValue: names.randomElement(),
					inputValidator: function(value) {
						return new Promise(function(resolve, reject) {
							if (value) {
								if (value.length > 21) {
									reject('Name is to long.')
								}
								else {
									resolve()
								}
							}
							else {
								reject('You need to write something!')
							}
						})
					}
				}).then(function(result1) {
					var result1 = result1.toLowerCase().substring(0, 20);

					swal({
						title: 'What color should you be? Same color = Same Team',
						input: 'text',
						showCancelButton: false,
						allowEscapeKey: false,
						inputValue: color.randomElement(),
						inputValidator: function(value) {
							return new Promise(function(resolve, reject) {
								if (value) {
									resolve()
								}
								else {
									reject('You need to write a color!')
								}
							})
						}
					}).then(function(result2) {
						connect(`${result1},${result2}`);
						window.location.hash = `${result1},${result2}`;
					})


				})
			}
		}
		start();
	</script>

</body>
